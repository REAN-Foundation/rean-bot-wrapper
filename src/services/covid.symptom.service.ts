const MSG0 = "You have not made a selection. Please start again and select options for each question so that I can help give you advice";
const MSG1 = "Sounds like you are feeling ok";
const MSG2 = "no Care Message 2";
const MSG3 = "no Care Message 3";
const MSG4 = "Based on your symptoms, you may need urgent medical care. Please call 911 or go to the nearest emergency department";
const MSG5 = "Call your medical provider, clinician advice line, or telemedicine provider as soon as possible You also have medical conditions that may put you at risk of becoming more seriously ill.";
const MSG6 = "Call your medical provider, clinician advice line, or telemedicine provider as soon as possible";
const MSG7 = "Tell a caregiver in your facility that you are sick and need to see a medical provider as soon as possible. Stay in your room as much as possible except to get medical care.";
const MSG8 = "Stay home except to get medical care and take care of yourself. Call your medical provider if you start feeling worse";
const MSG9 = "Stay home except to get medical care and take care of yourself. Call your medical provider, clinician advice line, or telemedicine provider.";
const MSG10 = "Watch for COVID-19 symptoms such as fever, cough, or difficulty breathing> If you develop any of these symptoms or if you start feeling worse, call your medical provider, clinician advice line, or telemedicine provider.";
const MSG11 = "Please check with your Ministry of Health or local health department for additional information and guidelines about COVID-19 in your location.";
const MSG12 = "Please consent to use the Coronavirus Self-Checker. Refresh the page to start again.";
const MSG13 = "Thanks! Your location has its own self-assessment tool. Please click here** to be directed to it.";
const MSG14 = "If you start to feel sick, tell a medical provider in the care center, nursing home, or shelter where you live.";
const MSG15 = "As soon as possible, tell your occupational health provider (or supervisor) that you may have been in contact with someone with suspected COVID-19.";
const MSG16 = "Watch for COVID-19 symptoms such as fever, cough, or difficulty breathing. If you develop any of these symptoms, call your medical provider, clinician advice line, or telemedicine provider.";
const MSG17 = "Watch for COVID-19 symptoms such as fever, cough, or difficulty breathing. If you develop any of these symptoms, call your medical provider, clinician advice line, or telemedicine provider.";
const MSG18 = "Stay home for 14 days from the day you last had contact. Watch for COVID-19 symptoms such as fever, cough, or difficulty breathing. If you develop any of these symptoms, call your medical provider, clinician advice line, or telemedicine provider.";
const MSG19 = "This tool is intended for people 2 years or older. Please call the child’s medical provider, clinician advice line, or telemedicine provider if your child is less than 2 years old and sick.";
const MSG20 = "Please ask your parent or guardian to help you complete these questions.";
const MSG21 = "Please ask your parent or guardian to answer these questions with you";
const MSG22 = "Ask a parent or guardian to assist you, or if taking by yourself, share these results with your parent/guardian.";
const MSG23 = "no Care Message 23";
const MSG24 = "Contact an administrator or nurse at your school or child care as soon as possible.";
const MSG25 = "Tell a caregiver in your facility that you may have been in close contact with someone who may have COVID-19.";
const MSG26 = "Tell an administrator or nurse at your school or child care that you may have been in contact with someone with suspected COVID-19.";
const MSG27 = "Stay home and away from others until: it has been 10 days* from when your symptoms first appeared and you have had no fever for 24 hours without the use of medications and your other symptoms of COVID-19 are improving* (*Loss of taste and smell may persist for weeks or months after recovery and need not delay the end of isolation) * If you have a weakened immune system (immunocompromised) due to a health condition or medication, you might need to stay home and isolate longer than 10 days and possibly 20 days after 45 | P a g e symptoms begin. In some circumstances, further testing may be needed. Talk to your healthcare provider for more information. Additional information (dropdown menu) Please inform your close contacts that they have been potentially exposed to SARS-CoV-2. CDC recommends that all close contacts of people with confirmed or probable COVID-19 should: o get tested and o quarantine for 14 days from the day of their last exposure. You may also receive a call from a contact tracing professional. Get rest and stay hydrated. Take over-the-counter medicines, such as acetaminophen, if needed to help you feel better. Separate yourself from other people. As much as possible, stay in a specific room and away from other people and pets in your home.";
const MSG28 = "Stay home and away from others until: it has been 10 days* from when your symptoms first appeared and you have had no fever for 24 hours without the use of medications and your other symptoms are improving* (*Loss of taste and smell may persist for weeks or months after recovery and need not delay the end of isolation) *If you have a weakened immune system (immunocompromised) due to a health condition or medication, you might need to stay home and isolate longer than 10 days and possibly 20 days after symptoms begin. In some circumstances, further testing may be needed. Talk to your healthcare provider for more information. Please note: It is possible that you were very early in your infection when your sample was collected and that you could test positive later. If your symptoms worsen after testing negative, please contact your healthcare provider.";
const MSG29 = "While waiting for your test results, isolate at home and follow the advice of your health care provider or public health professional.";
const MSG30 = "Stay home and away from others until: it has been 10 days* from when your symptoms first appeared and you have had no fever for 24 hours without the use of medications and your other symptoms of COVID-19 are improving* (*Loss of taste and smell may persist for weeks or months after recovery and need not delay the end of isolation) *If you have a weakened immune system (immunocompromised) due to a health condition or medication, you might need to stay home and isolate longer than 10 days and possibly 20 days after symptoms begin. In some circumstances, further testing may be needed. Talk to your healthcare provider for more information.";
const MSG31 = "CDC recommends that all close contacts of people with confirmed COVID-19 should quarantine for 14 days from the day of their last exposure. Check your local health department’s website for information about options in your area to possibly shorten this quarantine period. You may also receive a call from a contact tracing professional.";
const MSG201 = "If you continue to have no symptoms, you can be around others after: 10 days have passed since the date you had your positive test.46 | P a g e Watch for COVID-19 symptoms such as fever, cough, or difficulty breathing. If you develop any of these symptoms, call your medical provider, clinician advice line, or telemedicine provider";
const MSG202 = "Ask a caregiver in your facility about when you can resume being around other people based on the results of your testing.";
const MSG203 = "Contact the occupational health provider (or supervisor) in your workplace to find out when you can resume being around other people based on the results of your testing.";
const MSG204 = "Contact your healthcare provider to find out when you can resume being around other people based on the results of your testing.";
const MSG205 = "Tell a caregiver in your facility that you are not feeling well and need to see a medical provider as soon as possible.";
const MSG206 = "Tell the occupational health provider (or supervisor) in your workplace about your symptoms as soon as possible.";
const MSG207 = "no Care Message 207";
const MSG208 = "Call your medical provider, clinician advice line, or telemedicine provider. If you start feeling worse, and you think it is an emergency, call 911 or seek medical care immediately.";
const MSG209 = "Tell a caregiver in your facility that you have developed new symptoms and need to see a medical provider as soon as possible.";
const MSG210 = "Your symptoms may be caused by COVID-19. While most people with recover and return to normal health, some people have symptoms that can last for weeks or months after having COVID19. It’s important to notify your healthcare provider of your symptoms because it could affect your health care needs in the future.";
const MSG211 = "Stay home and away from others until: it has been 10 days* from when your symptoms first appeared and you have had no fever for 24 hours without the use of medications and your other symptoms of COVID-19 are improving* (*Loss of taste and smell may persist for weeks or months after recovery and need not delay the end of isolation) *If you had severe illness from COVID-19 (you were admitted to a hospital and needed oxygen), your healthcare provider may recommend that you stay in isolation for longer than 10 days after your symptoms first appeared (possibly up to 20 days) and you may need to finish your period of isolation at home. Talk to your healthcare provider for more information. <> While most people recover and return to normal health, some people have symptoms that can last for weeks or months after having COVID-19. It’s important to notify your healthcare provider of your symptoms because it could affect your health care needs in the future";
const MSG212 = "Watch for COVID-19 symptoms such as fever, cough, or difficulty breathing. If you develop any symptoms, contact your healthcare provider to ask about retesting, and stay home and away from others until: it has been 10 days from when your symptoms first appeared and you have had no fever for 24 hours without the use of medications and your other symptoms of COVID-19 are improving* (*Loss of taste and smell may persist for weeks or months after recovery and need not delay the end of isolation) MSG213. <> If you develop any symptoms, contact your healthcare provider, and stay home and away from others until: it has been 10 days from when your symptoms first appeared and you have had no fever for 24 hours without the use of medications and your other symptoms of COVID-19 are improving* (*Loss of taste and smell may persist for weeks or months after recovery and need not delay the end of isolation)";
const MSG213 = "Watch for COVID-19 symptoms such as fever, cough, or difficulty breathing. If you develop any symptoms, contact your healthcare provider, and stay home and away from others until: it has been 10 days from when your symptoms first appeared and you have had no fever for 24 hours without the use of medications and your other symptoms of COVID-19 are improving* (*Loss of taste and smell may persist for weeks or months after recovery and need not delay the end of isolation)";
const MSG214 = "As soon as possible, tell your occupational health provider (or supervisor) that you may have been in close contact with another person who has tested positive for COVID-19 in the last 14 days.";
const MSG215 = "While waiting for your test results, isolate at home and follow the advice of your health care provider or public health professional.";
const MSG216 = "Tell a caregiver in your facility that you may have been in close contact with another person who has tested positive for COVID-19 in the last 14 days.";

const T0 = "Based on the answers given, you do not need to get tested unless recommended or required by your healthcare provider, employer, or public health official.";
const T1 = "no testing message T1";
const T2 = "Domestic [no testing message T2-Domestic]";
const T3 = "CDC recommends that all close contacts of people with confirmed COVID-19 should: get tested and quarantine for 14 days from the day of their last exposure. Check your local health department’s website for information about options in your area to possibly shorten this quarantine period. You may also receive a call from a contact tracing professional.";
const T4 = "Regardless of vaccination status or prior infection, CDC recommends that anyone with symptoms of COVID-19 should get tested and follow the advice of your healthcare provider. Contact your local or state health department to find a testing location near you.";
const T5 = "Further testing may not be needed at this time, unless recommended by a provider.";
const T6 = "Further testing may not be needed at this time, unless recommended by a provider.";
const T50 = "Regardless of vaccination status or prior infection, CDC recommends that anyone with symptoms of COVID-19 should get tested and follow the advice of your healthcare provider. Contact your local or state health department to find a testing location near you.";
const T100 = "You do not need to quarantine or get tested as long as you do not develop new symptoms. Ask your healthcare provider about getting tested again if you have been in close contact with another person who has tested positive for COVID-19 in the last 14 days.";
const T101 = "Ask your healthcare provider about getting tested again if you have been in close contact with another person who has tested positive for COVID-19 in the last 14 days or if you develop new symptoms.";
const T102 = "You may continue to test positive for three months or more without being contagious to others. Talk with your healthcare provider about your test result and the type of test you took to understand what your results mean.";
const T103 = "Regardless of vaccination status or prior infection, you may need to be tested again if there is no other cause identified for your symptoms. Ask your healthcare provider about getting tested again for SARS-CoV-2 infection to consider the possibility of reinfection.";
const T104 = "Ask your healthcare provider about getting tested again, especially if you have been in close contact with another person who has tested positive for COVID-19 in the last 14 days.";
const T105 = "Talk with your healthcare provider about your test result and the type of test you took to understand what your results mean.";
const T106 = "If there is no other cause identified for your symptoms, ask your healthcare provider about getting tested again. Talk with your healthcare provider about your test result and the type of test you took to understand what your results mean.";
const T107 = "Because you have been in close contact of another person who has tested positive for COVID19 in the last 14 days, CDC recommends that you quarantine for 14 days from the day of your last exposure.";
const T108 = "T108. get tested and quarantine for 14 days from the day of your last exposure. Check your local health department’s website for information about options in your area to possibly shorten this quarantine period. You may also receive a call from a contact tracing professional.";
const T109 = "Based on the answers given, you do not need to get tested unless recommended or required by your healthcare provider, employer, or public health official.";

function getMessages(list = []) {
    let message = "";
    for (let i = 0; i < list.length; i++) {
        message = message ? message + " \n " + list[i] : list[i];
    }
    return message;
}
const ternaryCondition = (condition, then, otherwise) => (condition ? then : otherwise);
export const getSymptoms = async (req, res) => {
    return new Promise(async (resolve, reject) => {
        try {
            console.log('START--------');
            const params = req.body.queryResult.parameters ? req.body.queryResult.parameters : '';
            let response_message = "Not found";

            if (params) {
                const age = params.age.amount;
                const exposure = params.expo.toLowerCase();
                let primarySymptoms = 0, secondarySymptoms = 0;
                const symptoms = params.symptom;
                if (symptoms.length > 0) {
                    primarySymptoms = symptoms.reduce((n, x) => n + (x === 'Primary Symptoms'), 0);
                    secondarySymptoms = primarySymptoms ? 0 : symptoms.reduce((n, x) => n + (x === 'Secondary Symptoms'), 0);
                }
                const livingCondition = params.livingcondition.toLowerCase();
                const hcw = params.healthcare.toLowerCase();
                const complication = params.conditions.length ? ternaryCondition(params.conditions[0].toLowerCase() != "no", params.conditions.length, 0) : 0;
                if (age >= 18 && age < 65) {
                    if (exposure == "no") {
                        if (primarySymptoms >= 2) {
                            if (secondarySymptoms == 0) {
                                if (livingCondition == "yes") {
                                    if (hcw == "no") {
                                        response_message = getMessages([MSG7, T4, MSG30, T50]);
                                    }
                                }
                                else {
                                    let complications;
                                    if (hcw == "yes") {
                                        response_message = getMessages([MSG9, MSG6, T4, MSG30, T50]);
                                    }
                                    else if (complications != 0) response_message = getMessages([MSG5, T4, MSG31, MSG30, T50]);
                                    else response_message = getMessages([MSG8, T4, MSG30, T50]);
                                }
                            }
                        }
                        else if (primarySymptoms >= 1) {
                            if (secondarySymptoms == 0) {
                                if (livingCondition == "yes") {
                                    if (hcw == "no") {
                                        response_message = getMessages([MSG7, T4, MSG30, T50]);
                                    }
                                }
                                else {
                                    if (hcw == "yes") {
                                        response_message = getMessages([MSG8, MSG6, T4, MSG30, T50]);
                                    }
                                    else {
                                        if (complication > 0) response_message = getMessages([MSG5, T4, MSG30, T50]);
                                        else response_message = getMessages([MSG8, T4, MSG30, T50]);
                                    }
                                }
                            }
                        }
                        else if (primarySymptoms == 0) {
                            if (secondarySymptoms != 0) {
                                if (livingCondition == "no") {
                                    if (hcw == "no") {
                                        response_message = getMessages([MSG8, T4, MSG30, T50]);
                                    }
                                    else response_message = getMessages([MSG8, MSG6, T4, MSG30, T50]);
                                }
                                else {
                                    if (hcw == "no") {
                                        response_message = getMessages([MSG7, T4, MSG30, T50]);
                                    }
                                }
                            }
                            else {
                                if (livingCondition == "no") {
                                    if (hcw == "no") {
                                        response_message = getMessages([T109]);
                                    }
                                    else response_message = getMessages([MSG214, T108, MSG213, T105]);
                                }
                                else {
                                    if (hcw == "no") {
                                        response_message = getMessages([MSG202, T105]);
                                    }
                                }
                            }
                        }
                    }
                    else if (exposure == "yes") {
                        if (primarySymptoms >= 2 && secondarySymptoms == 0 && livingCondition == "no" && hcw == "no") {
                            response_message = getMessages([MSG5, T4, MSG31, MSG30, T50]);
                        }
                        else if (primarySymptoms >= 1) {
                            if (secondarySymptoms == 0) {
                                if (livingCondition == "no") {
                                    if (hcw == "no") {
                                        response_message = getMessages([MSG8, T4, MSG31, MSG30, T50]);
                                    }
                                    else response_message = getMessages([MSG8, MSG6, T4, MSG31, MSG30, T50]);
                                }
                                else {
                                    if (hcw == "no") {
                                        response_message = getMessages([MSG7, T4, MSG31, MSG30, T50]);
                                    }
                                }
                            }
                        }
                        else if (primarySymptoms == 0) {
                            if (secondarySymptoms != 0) {
                                if (livingCondition == "no") {
                                    if (hcw == "no") {
                                        response_message = getMessages([MSG8, T4, MSG31, MSG30, T50]);
                                    }
                                    else response_message = getMessages([MSG8, MSG6, T4, MSG31, MSG30, T50]);
                                }
                                else {
                                    if (hcw == "no") response_message = getMessages([MSG7, T4, MSG31, MSG30, T50]);
                                }
                            }
                            else {
                                if (livingCondition == "no") {
                                    if (hcw == "no") response_message = getMessages([T108, MSG213, T105]);
                                }
                                else {
                                    if (hcw == "no") response_message = getMessages([MSG216, MSG202, T108, T105]);

                                }
                            }
                        }
                    }
                }
                else if (age >= 65) {
                    if (exposure == "no") {
                        if (primarySymptoms >= 2) {
                            if (secondarySymptoms == 0) {
                                if (livingCondition == "no") {
                                    if (hcw == "no") response_message = getMessages([MSG5, T4, MSG30, T50]);
                                } else { response_message = getMessages([MSG7, T4, MSG30, T50]); }
                            }
                        }
                        else if (primarySymptoms >= 1) {
                            if (secondarySymptoms == 0) {
                                if (livingCondition == "no") {
                                    if (hcw == "no") response_message = getMessages([MSG5, T4, MSG30, T50]);
                                } else { response_message = getMessages([MSG7, T4, MSG30, T50]); }
                            }
                        } else {
                            if (secondarySymptoms != 0) {
                                if (livingCondition == "no") {
                                    if (hcw == "no") response_message = getMessages([MSG5, T4, MSG30, T50]);
                                }
                            }

                        }
                    } else if (exposure == "yes") {
                        if (primarySymptoms >= 1) {
                            if (secondarySymptoms == 0) {
                                if (livingCondition == "no") {
                                    if (hcw == "no") response_message = getMessages([MSG5, T4, MSG31, MSG30, T50]);
                                }
                                else if (hcw == "no") response_message = getMessages([MSG7, T4, MSG31, MSG30, T50]);
                            }
                        } else {
                            if (secondarySymptoms != 0) {
                                if (livingCondition == "no") {
                                    if (hcw == "no") response_message = getMessages([MSG5, T4, MSG31, MSG30, T50]);
                                }
                            }

                        }
                    }
                }
            }
            if (response_message == "Not found") {
                reject(response_message);
            }
            else {

                const response = {
                    "fulfillmentMessages" : [
                        {
                            "text" : {
                                "text" : [
                                    response_message
                                ]
                            }
                        }
                    ]
                };

                resolve(response);
            }
        }
        catch (error) {
            console.log(error, 500, "Covid Info Service Error!");
            reject(error.message);
        }
    });

};
